# Eureka common
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.client.service-url.defaultZone=http://discovery-service:8761/eureka/

# Tracing
management.tracing.enabled=true
management.tracing.sampling.probability=1
management.otlp.tracing.endpoint=http://otel-collector:4318/v1/traces
management.otlp.tracing.timeout=30s
# Enable histogram buckets for http server requests
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# OTLP Metrics Export - DISABLED
# Prometheus already scrapes metrics from /actuator/prometheus, so OTLP metrics export is not needed.
# Keeping this disabled avoids duplicate metrics and 404 errors from otel-collector.
management.otlp.metrics.export.enabled=false
#management.otlp.metrics.export.url=http://otel-collector:4318/v1/metrics
#management.otlp.metrics.export.step=10s
#management.otlp.metrics.export.timeout=30s
#management.otlp.metrics.export.connect-timeout=10s

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,prometheus,env,configprops,loggers,threaddump,heapdump,orders,inventory,circuitbreakers,circuitbreakerevents,ratelimiters,retries,bulkheads
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=when-authorized

# Resilience4j Health Indicators - Show circuit breaker state in /actuator/health
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Prometheus / monitoring
management.prometheus.metrics.export.enabled=true

# Info endpoint customization
management.info.env.enabled=true
management.info.java.enabled=true
management.info.os.enabled=true
management.info.git.enabled=true
management.info.git.mode=full

# Metrics configuration
management.metrics.tags.application=${spring.application.name}
management.metrics.tags.environment=production
management.metrics.distribution.percentiles.http.server.requests=0.5,0.95,0.99
management.metrics.distribution.slo.http.server.requests=50ms,100ms,200ms,500ms,1s,2s
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.enable.tomcat=true
management.metrics.enable.logback=true

# HTTP trace
management.trace.http.enabled=true

# Logging
logging.pattern.correlation=[%X{traceId:-},%X{spanId:-}]
logging.include-application-name=false

spring.rabbitmq.host=rabbitmq
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

spring.rabbitmq.listener.simple.acknowledge-mode=auto
spring.rabbitmq.listener.simple.prefetch=1

spring.rabbitmq.listener.simple.retry.enabled=true
# Maximum number of attempts before moving the message (to DLQ)
spring.rabbitmq.listener.simple.retry.max-attempts=3
# Initial wait time before first retry
spring.rabbitmq.listener.simple.retry.initial-interval=5000ms
# Maximum interval cap (used with multiplier)
spring.rabbitmq.listener.simple.retry.max-interval=15000ms
# Multiplier for backoff (5s, 10s, 15s)
spring.rabbitmq.listener.simple.retry.multiplier=2.0
spring.rabbitmq.listener.simple.default-requeue-rejected=false

resilience4j.timelimiter.configs.default.timeout-duration=5s
resilience4j.timelimiter.configs.default.cancel-running-future=true

spring.threads.virtual.enabled=true

# for testing, will remove in production
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} %5p [${PID}] [%t] %-40logger{39} : %m%n
logging.level.org.springframework.web=DEBUG
logging.level.com.nirmalks.bookstore=DEBUG

# for idempotency testing cleanup 
#idempotency.cleanup.cron=*/30 * * * * ?
#idempotency.cleanup.retention-days=0